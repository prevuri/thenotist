%div{:'ng-controller' => 'NoteCtrl', :'ng-init' => "init()"}

  %link{:'ng-repeat' => 'css_file in note.uploaded_css_files', :type => "text/css", :rel => "stylesheet", :'ng-href' => "{{css_file.public_path}}"}

  #note-header
    %h1.note-title  {{note.title}}
    .note-description {{note.description}}
    .page-number
      .pages
        /TODO make dynamic
        Page
        %span
          1
        of {{note.uploaded_html_files.length}}
      .profile-container.circular.prev-page
        %i.icon-angle-left
      .profile-container.circular.next-page
        %i.icon-angle-right
      .profile-container.circular.flag
        %i.icon-exclamation
    .contributors
      .profile-container.circular.share-note
        %i.icon-plus
      .profile-container.circular{:'ng-repeat' => 'contrib in note.contributors'}
        %img.profile-image.circular{:'ng-src' => 'contrib.user.user_fb_data.profile_image'}

  .flag-report-form-container.modal.hide.fade{ :role => :dialog, :tabindex => -1, "aria-labelledby" => "myModalLabel", "aria-hidden" => true }
    .form-container.modal-body
      .form-container
        =form_for :new_flag_report, :html => { :id => "flag_report_form_tag", :'ng-submit' => 'submit()' } , :url => api_flag_reports_path, :method => :post do |f|
          %input{:type => "radio", :name => "flag_report_category", :id => "default", :value => "Legal - Privacy, Copyright, or Other", :checked => "checked" } Privacy, copyright, or or other legal complaints
          %br
          %input{:type => "radio", :name => "flag_report_category", :value => "Content - Intentionally Inaccurate"} Intentionally inaccurate content
          %br
          %input{:type => "radio", :name => "flag_report_category", :value => "Content - Hateful or Abusive"} Hateful or abusive content
          %br
          %input{:type => "radio", :name => "flag_report_category", :value => "Content - Violent or Repulsive"} Violent or repulsive content
          #description-field.text-field
            =f.text_field :description, :id => 'flag-description-field', :placeholder => "Enter note description (optional)"
    .form-container.modal-footer
      .btn.btn-primary.submit-action{ :note_id => '{{note.id}}', :'ng-disabled' => '!controlsEnabled', :'ng-click' => "submitReport(note.id)" }
        .submit-action-text Send Report

  #note-main{:'ng-class' => 'pageShifted ? "shifted" : ""'}
    .note-pages
      .page{:'ng-repeat' => 'file in note.uploaded_html_files'}
        .file-container{:'ng-init' => "getComments(file.id, $index)"}
          .page-container
            %a{ :name => "Page-{{file.page_number}}"}
            .note-page{:'file-id' => '{{file.id}}'}
              %div{:'ng-include' => 'file.trusted_path'}
        .comment-buttons-container
          .comment-button{:'ng-repeat' => "comment in file.comments", :line_id => "{{comment.line_id}}", :'ng-click' => 'expandCommentLine(comment.line_id)', :'ng-style' => "{top: commentY(comment.line_id)+'px'}", :'ng-class' => 'expandedCommentLine == comment.line_id ? "active" : "inactive"'}
            .profile-container.circular
              .profile-image.circular{:'ng-style' => "{background: 'url('+ comment.user.user_fb_data.profile_image + ') no-repeat'}"}
                .profile-image.circular.overlay
        .comments-container{:'ng-class' => 'expandedCommentLine == null ? "comments-hidden" : ""'}
          .comments
            %ng-include{:src => '"/client_views/comments.html"'}
    #new-comment-panel.comment{:'ng-show' => 'showingNewComment', :'ng-style' => "{'top': newCommentY+'px' }"}
      .profile-container.circular
        .profile-image.circular{:'ng-style' => "{background: 'url(' + currentUser.user_fb_data.profile_image + ') no-repeat'}"}
      .comment-inner
        .comment-body
          .user
            .name
              {{currentUser.name}}
          .comment-text
            %textarea#newcomment.new_comment_text_field{:placeholder => 'Enter your comment here', :'ng-model' => 'newCommentText', :'textarea-autoheight' => true, :autofocus => 'showingNewComment'}
        .bottom
          %a.new-comment-submit.primary.text-link{:'ng-click' => 'submitParentComment($index)'}
            Add Comment
          %a.new-comment-cancel.secondary.text-link{:'ng-click' => 'showNewComment(false)'}
            Cancel
        .clear

    #note-shift-overlay{:'ng-show' => 'expandedCommentLine != null', :'ng-click' => 'expandCommentLine(null)'}
